#Utilizes custom variables for deployment of group tags
addigy_folder_name="FortiClient (7.0.11)"
dmg_name="FortiClient_7.0.11.dmg"

#Mount dmg
hdiutil attach "/Library/Addigy/ansible/packages/$addigy_folder_name/$dmg_name"  -noverify -nobrowse -noautoopen

#Copy contents from dmg
mkdir "/Library/Addigy/ansible/packages/$addigy_folder_name/extract"
cp -R /Volumes/FortiClient/* "/Library/Addigy/ansible/packages/$addigy_folder_name/extract"

#Detach dmg
sleep 3
hdiutil detach /Volumes/FortiClient/

#Update group tag
sed -i -E "s|<group_tag>.*</group_tag>|<group_tag>${forticlient_group_tag}</group_tag>|I" "/Library/Addigy/ansible/packages/$addigy_folder_name/extract/fctdata/default.conf"

#Install FortiClient
/usr/sbin/installer -pkg "/Library/Addigy/ansible/packages/$addigy_folder_name/extract/Install.mpkg" -target /

#Cleanup
sleep 3
rm -rf "/Library/Addigy/ansible/packages/$addigy_folder_name/extract"
